{% extends "global/Page.html" %}
{% load staticfiles otree_tags %}

{% block styles %}
<link href="{% static "cultural_market/style.css" %}" rel="stylesheet">
{% endblock %}

{% block title %}
    {{ title }}
{% endblock %}

{% block content %}

<script type="text/javascript">
numArtifacts = {{ num_artifacts }};
var getViewHandler = function (artifact) {
    var viewed = false;
    return function () {
        $("#id_view_" + artifact).val('1');
        // Add 1 to visible count if not yet viewed
        if (!viewed) {
            var count = parseInt($("#view-count-" + artifact).text());
            $("#view-count-" + artifact).text(count + 1);
            viewed = true;
        }
        startTime = (new Date()).getTime();
    };
};
var getDownloadHandler = function (artifact) {
    var downloaded = false;
    return function () {
        $("#id_download_" + artifact).val('1');
        // Add 1 to visible count if not yet viewed
        if (!downloaded) {
            var count = parseInt($("#download-count-" + artifact).text());
            $("#download-count-" + artifact).text(count + 1);
            downloaded = true;
        }
    };
};
var getCloseHandler = function (artifact) {
    return function () {
        timeOnArtifact[artifact] += (new Date()).getTime() - startTime;
        $("#id_time_ms_" + artifact).val(timeOnArtifact[artifact])
    };
};
timeOnArtifact = []
var startTime;
$(document).ready(function () {
    for (var i = 0; i < numArtifacts; i++) {
        $(".play-media-" + i).click(getViewHandler(i));
        $("#media-player-" + i + " .close").click(getCloseHandler(i));
        $("#media-player-" + i + " .done").click(getCloseHandler(i));
        $(".download-" + i).click(getDownloadHandler(i));
        timeOnArtifact.push(0);
    }
});
</script>

<div id="market-image">
    
    <div class="row">
        <div class="col-md-12">
            <p>
                This page contains a list of images you might find interesting.
                Click image titles to open them.
            </p>
            <p class="debug">
                DEBUG: World {{ world }}
            </p>
        </div>
    </div>
    
    {% for artifact_row in artifacts %}
        {% for a in artifact_row %}
            {% include 'cultural_market/ImagePlayer.html' with artifact=a config=config %}
        {% endfor %}
    {% endfor %}
    
    {% for artifact_row in artifacts %}
        <div class="row">
        {% for a in artifact_row %}
            {% include "cultural_market/Image.html" with artifact=a config=config width=width%}
        {% endfor %}
        </div>
    {% endfor %}
    
</div>

    {% next_button %}

{% endblock %}
